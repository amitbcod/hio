<?phpuse App\Controllers\WholesalePlatform\PlaceWholesaleOrderController;use Psr\Http\Message\ResponseInterface as Response;use Psr\Http\Message\ServerRequestInterface as Request;$app->post('/wholesale_platform/place_order', PlaceWholesaleOrderController::class);$app->get('/wholesale_platform/ExportCSVWholesale/{shopcode}', function (Request $request, Response $response, $args){	//$posted_data = $request->getParsedBody();//	extract($posted_data);    $shopcode = $args['shopcode'];    if($shopcode == ''){        echo 'error';        exit;    }else{        $sis_export_header = array("Style","Full Style Name","Name","Price","Location Available","Size","Size2","Color","Season","UPC","Internal ID","Weight","Release Date","Manufacturer Country","Manufacturer Tariff");        $wholesale_obj = new DbWholeSale();        $webshop_obj = new DbProductFeature();        $product_list = $wholesale_obj->getInStockProducts($shopcode);        $ExportValuesArr = array();        if($product_list != false){            foreach($product_list as $item){                $product_code = '';                $launch_date = '';                $color = '';                $size = '';                $shoe_size = '';                $collection_name = '';                $manufacturer_tariff = '';                $country_of_origin = '';                $attribute =array();                $variant_opt = array();                $variant_details = $wholesale_obj->variantOptions($shopcode,$item['id']);                if($variant_details != false){                    $variant_opt = array();                    foreach($variant_details as $variant){                        if($variant['attr_code']=='color' || $variant['attr_code']=='size' ||  $variant['attr_code']=='shoe_size' ){                            $variant_opt[$variant['attr_code']] = $variant['attr_options_name'];                        }                    }                }                if(isset($variant_opt['color'])){                    $color =  $variant_opt['color'];                }                if(isset($variant_opt['size'])){                    $size =  $variant_opt['size'];                }                if(isset($variant_opt['shoe_size'])){                    $shoe_size =  $variant_opt['shoe_size'];                }                //Other Data                if($item['parent_id'] > 0 ){                    $parent_details = $wholesale_obj->configurableProduct($shopcode,$item['parent_id']);                    if($parent_details != false){                        $product_code = $parent_details[0]['product_code'];                        $launch_date = date('d/m/Y',$parent_details[0]['launch_date']);                    }                    $product_id_send = $item['parent_id'];                }else{                    $product_code = $item['product_code'];                    $launch_date = date('d/m/Y',$item['launch_date']);                    $product_id_send = $item['id'];                }                $attr_details = $wholesale_obj->attributDetails($shopcode,$product_id_send);                    if($attr_details != false){                        $attribute = array();                        foreach($attr_details as $attr){                            if($attr['attr_code']=='country_of_origin' || $attr['attr_code']=='manufacturer_tariff' ||  $attr['attr_code']=='collection_name'){                                if($attr['attr_properties'] == 5 || $attr['attr_properties'] == 6){                                    $attr_value_ids = array();                                    $attr_value_arr=explode(',',$attr['attr_value']);                                    if(isset($attr_value_arr) && count($attr_value_arr)>0){                                        foreach($attr_value_arr as $attr_value_option){                                            $IsOptionExist=$wholesale_obj->check_attributes_options_exist_by_option_id($attr['id'],$attr_value_option);                                            if(isset($IsOptionExist)){                                                $attr_value_ids[]=$IsOptionExist[0]['attr_options_name'];                                            }else{                                            }                                        }                                        $attribute[$attr['attr_code']]=implode(',',$attr_value_ids);                                    }                                }else{                                    $attribute[$attr['attr_code']] = $attr['attr_value'];                                }                            }                        }                    }                if(isset($attribute['collection_name'])){                    $collection_name =  $attribute['collection_name'];                }                if(isset($attribute['country_of_origin'])){                    $country_of_origin =  $attribute['country_of_origin'];                }                if(isset($attribute['manufacturer_tariff'])){                    $manufacturer_tariff =  $attribute['manufacturer_tariff'];                }                $SingleRow =array(                    $product_code,                    $item['sku'],                    $item['name'],                    $item['price'],                    $item['available_qty'],                    $size,                    $shoe_size,                    $color,                    $collection_name,                    $item['barcode'],                    $item['id'],                    $item['weight'],                    $launch_date,                    $country_of_origin,                    $manufacturer_tariff,                );                $ExportValuesArr[]=$SingleRow;            }        }        $filename = 'Catalog-' . $shopcode .'-' . time() . '.csv';        header("Content-Description: File Transfer");        header("Content-Disposition: attachment; filename=$filename");        header("Content-Type: application/csv; ");        // file creation        $file = fopen('php://output', 'w');        fputcsv($file, $sis_export_header);        if(isset($ExportValuesArr) && count($ExportValuesArr)>0){            foreach ($ExportValuesArr as $readData) {                fputcsv($file, $readData);            }        }        fclose($file);        exit;        echo "success";exit;    }});